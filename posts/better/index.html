<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Tomáš Zemanovič">
 <meta name="keywords" content="blog, hakyll, highlight-js, highlight, javascript, cli" />
 
<link rel="shortcut icon" href="../../favicon.ico">

<title>maseek :: better code highlighting with hakyll</title>

<link href="http://fonts.googleapis.com/css?family=Permanent+Marker|Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="../../css/style.min.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>
<body role="document">
<div class="navigation" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../"><img src="../../images/logo.png" alt="maseek" /></a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="../../">blog</a></li>
                <li><a href="../../projects">projects</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="container" role="main">
    <h1>better code highlighting with hakyll</h1>
<div class="info">
    <i class="fa fa-calendar"></i> May 13, 2014
</div>
<div class="post-body">
	<p>If you want to highlight code syntax on your site there are couple of alternatives. I looked around and <a href="http://highlightjs.org/" target="_blank">highlight.js</a> seemed to be doing best. So I chose to load the JavaScript on the site and manually initialize it. Simple enough.</p>
<p>But then I realized that I could do better. Because I am using <a href="http://jaspervdj.be/hakyll/" target="_blank">Hakyll</a> to generate static version of my site, I could run the highlighting code on my site during the build, thus avoiding slowing down the page with yet another JavaScript.</p>
<p>To connect some pieces together I used <a href="http://nodejs.org/" target="_blank">node.js</a> to create a command that would run <a href="https://github.com/cheeriojs/cheerio" target="_blank">cheerio</a> (to get jQuery abilities) together with <a href="http://highlightjs.org/" target="_blank">highlight.js</a>. You can get the npm package <a href="https://www.npmjs.org/package/highlight.js-cli" target="_blank">highlight.js-cli</a> by running:</p>
<pre><code class="bash">npm install highlight.js-cli
</code></pre>

<p>There is a <a href="http://jaspervdj.be/hakyll/" target="_blank">Hakyll</a> function <a href="http://jaspervdj.be/hakyll/reference/Hakyll-Core-UnixFilter.html" target="_blank"><code>unixFilter</code></a> that can run a program as a <a href="http://jaspervdj.be/hakyll/tutorials/03-rules-routes-compilers.html#basic-compilers" target="_blank">compiler</a>. You have to run the <a href="https://www.npmjs.org/package/highlight.js-cli" target="_blank">highlight.js-cli</a> through node, pointing it to its source. Like this:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
  hakyll <span class="fu">$</span> <span class="kw">do</span>
    match <span class="st">&quot;posts/*&quot;</span> <span class="fu">$</span> <span class="kw">do</span>
      route <span class="fu">$</span> niceRoute
        compile <span class="fu">$</span> getResourceBody
            <span class="fu">&gt;&gt;=</span> withItemBody (unixFilter <span class="st">&quot;node&quot;</span> [<span class="st">&quot;..\\highlight.js-cli\\bin\\hljs&quot;</span>])
            <span class="fu">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;post&quot;</span>
            <span class="fu">&gt;&gt;=</span> pandocCompile
            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span>    postCtx
            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> postCtx
            <span class="fu">&gt;&gt;=</span> relativizeUrls
            <span class="fu">&gt;&gt;=</span> removeIndexHtml

<span class="ot">pandocCompile ::</span> <span class="dt">Item</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> <span class="dt">String</span>)
pandocCompile item <span class="fu">=</span> return <span class="fu">$</span> writePandoc <span class="fu">$</span> readPandoc item</code></pre>
<p>And if you put the name of the language in the class like this:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;pre&gt;&lt;code</span><span class="ot"> class=</span><span class="st">&quot;haskell&quot;</span><span class="kw">&gt;</span>
	main :: IO ()
<span class="kw">&lt;/code&gt;&lt;/pre&gt;</span></code></pre>
<p>The <a href="https://www.npmjs.org/package/highlight.js-cli" target="_blank">highlight.js-cli</a> will pick it up and pass it to <a href="http://highlightjs.org/" target="_blank">highlight.js</a>.</p>
</div>

<div id="sociallinks" class="social-share tooltips">
    <a href="../../" class="red" data-toggle="tooltip" data-placement="top" title data-original-title="back"><i class="fa fa-arrow-circle-o-left"></i></a>
    <a href="https://twitter.com/home?status=/posts/better/index.html" target="_blank" data-toggle="tooltip" data-placement="top" title data-original-title="tweet"><i class="fa fa-twitter"></i></a>
    <a href="http://www.facebook.com/sharer/sharer.php?u=/posts/better/index.html" target="_blank" data-toggle="tooltip" data-placement="top" title data-original-title="share on facebook"><i class="fa fa-facebook"></i></a>
    <a href="https://plus.google.com/share?url=/posts/better/index.html" target="_blank" data-toggle="tooltip" data-placement="top" title data-original-title="share on google+"><i class="fa fa-google-plus"></i></a>
    <a href="https://github.com/maseek/maseek-codes/blob/master/src/posts/better.markdown" class="red" target="_blank" data-toggle="tooltip" data-placement="top" title data-original-title="edit on github"><i class="fa fa-github-alt"></i></a>
</div>
<script>
(function(){window.addEventListener("DOMContentLoaded",function(){
                                    var url=document.location;
                                    var links=document.getElementById("sociallinks")
                                    .getElementsByTagName('a');
                                    for (var i=0;i!=links.length;i++){
                                    links[i].setAttribute("href",
                                        links[i].href.replace('/posts/better/index.html',url));}})})();
</script>

<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'maseek';

(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    <div class="footer">
        <div class="social-links">
            <a class="social" href="mailto:tzemanovic@gmail.com" target="_blank">
                <span class="symbol"><span class="zoom fa-stack fa-lg">
                        <i class="fa fa-square fa-stack-2x"></i>
                        <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                </span></span>
            </a>
            <a class="social" href="https://twitter.com/maseek" target="_blank"><span class="symbol">
                    <span class="symbol"><span class="zoom fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span></span>
            </span></a>
            <a class="social" href="https://github.com/maseek" target="_blank"><span class="symbol">
                    <span class="symbol"><span class="zoom fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                    </span></span>
            </span></a>
            <a class="social" href="../../feed.xml" target="_blank"><span class="symbol">
                    <span class="symbol"><span class="zoom fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                    </span></span>
            </span></a>
            <a class="social" href="https://www.linkedin.com/pub/tomas-zemanovic/40/807/196" target="_blank"><span class="symbol">
                    <span class="symbol"><span class="zoom fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                    </span></span>
            </span></a>

        </div>
        <div class="about">
            <p>Tomáš Zemanovič<br />Glasgow</p>
            <p>made with <a href="http://jaspervdj.be/hakyll/" target="_blank">Hakyll</a></p>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="../../js/isotope.pkgd.min.js"></script>
<!-- bashe, c++, haskell -->
<script src="../../js/maseek.min.js"></script>
</script>
</body>
</html>
